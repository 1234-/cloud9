<a:application xmlns:a="http://ajax.org/2005/aml">
    <a:skin id="skinissues" 
      src        = "{require('ext/issuesmgr/issuesmgr').skin}" 
      media-path = "/static/ext/issuesmgr/images/" />
    <a:style><![CDATA[
        .filtersBar {
            border-bottom: 1px solid #bbb;
        }
    ]]></a:style>
    <a:script><![CDATA[
        function formatDate(timestamp) {
            var d = new Date(timestamp);
            return d.toString("MMMM dd, yyyy");
        }
    ]]></a:script>
    <a:window id="winIssuesMgr"
      flex     = "1"
      skin     = "fm-window"
      title    = "Issues"
      modal    = "false"
      visible  = "false"
      buttons  = "close"
      optimize = "true">
        <a:model id="mdlIssues"></a:model>
        <a:menu id="mnuIssuesOrder">
            <a:item type="check">Ascending</a:item>
            <a:item type="check" checked="true">Descending</a:item>
        </a:menu>
        <a:menu id="mnuIssuesSort">
            <a:item submenu="mnuIssuesOrder">Order</a:item>
            <a:divider />
            <a:item type="check" checked="true">Submitted</a:item>
            <a:item type="check">Updated</a:item>
            <a:item type="check">Comments</a:item>
        </a:menu>
        <a:tab id="tabIssues" skinset="skinissues" skin="issuestab"
            anchors="0 0 0 0" flex="1">
            <a:page id="pgIssuesList" caption="Issues">
                <a:bar height="35" class="filtersBar">
                    <a:hbox edge="5 12 5 12">
                        <a:textbox 
                          id              = "tbIssuesSearch"
                          disabled = "true"
                          realtime        = "true"
                          flex            = "1"
                          skin            = "searchbox_textbox"
                          class           = "small_font"
                          focusselect     = "true"
                          initial-message = "Search by Title or User"
                          margin          = "0 12 0 0"
                        />
                        <a:button
                          id = "btnIssuesSort"
                          disabled = "true"
                          width = "60"
                          caption = "Sort"
                          submenu = "mnuIssuesSort"
                        />
                    </a:hbox>
                </a:bar>
                <a:list id="lstIssues" skinset="skinissues" skin="issueslist"
                  flex="1" anchors="35 0 0 0" border="0" multiselect="false"
                  autoselect="false" model="mdlIssues" empty-message="Loading issues... sit tight :)">
                    <!-- Note set filter-fields to @title,@user,@body but too
                        slow for searching lots of issues against the body -->
                    <a:each
                      match         = "[issue]"
                      filter        = "{tbIssuesSearch.value}"
                      filter-fields = "@title,@user"
                      sort          = "[@number]"
                      data-type     = "number"
                      order         = "descending"
                    >
                        <a:caption><?lm
                            <div class="issue_top">
                                <div class="number">&#35;[@number]</div> <div class="title">{apf.htmlentities([@title])}</div>
                            </div>
                            <div class="issue_bottom">
                                <p>by 
                                    <span class="user">[@user]</span> on
                                    <span class="date">{formatDate([@created_at])}</span>
                                </p>
                                {if ([@comments] > 0) {
                                    <p class="comments">[@comments]</p>
                                }}
                            </div>
                        ?></a:caption>
                    </a:each>
                </a:list>
            </a:page>
        </a:tab>
    </a:window>
</a:application>
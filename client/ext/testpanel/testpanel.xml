<a:application xmlns:a="http://ajax.org/2005/aml">
    <a:window id="winTestPanel" 
      flex     = "1" 
      skin     = "fm-window" 
      title    = "Test Panel" 
      modal    = "false" 
      visible  = "true" 
      buttons  = "close" 
      optimize = "true">
        <a:state id="stTestRun" />
      
        <a:button
          top="-22"
          skin="header-btn"
          right="5"
          icon="refresh.png"
          submenu = "mnuFilter" />
        <a:menu id="mnuFilter">
            <a:item type="radio" value="all" selected="true">All</a:item>
            <a:divider />
            
            <a:divider />
            <a:item type="check" checked="true" onclick="
                require('ext/testpanel/testpanel').toggleSubmodules(this.value);
            ">Show Submodules</a:item>
        </a:menu>
        <a:vbox anchors = "0 0 0 0">
            <a:bar skin="basic" style="background-color:#333;padding:2px;border-bottom:1px solid #222">
                <a:hbox>
                    <a:splitbutton
                      id       = "btnNewTestType"
                      icon     = "application_add.png"
                      caption  = "New"
                      onclick  = ""
                      submenu  = "mnuTestNew" />
                    <a:menu id="mnuTestNew">
                        
                    </a:menu>
                    
                    <!--a:divider skin="c9-divider-double" /-->
                    
                    <a:splitbutton
                      icon     = "run.png"
                      caption  = "Run"
                      onclick  = "require('ext/testpanel/testpanel').run(dgTestProject.getSelection());"
                      submenu  = "mnuRunSettings" 
                      disabled = "{stTestRun.active or !dgTestProject.selected}" />
                    <a:menu id="mnuRunSettings" pinned="true">
                        
                    </a:menu>
                
                    <a:button
                      icon     = "stop.png"
                      caption  = "stop"
                      skin     = "c9-toolbarbutton"
                      onclick  = "require('ext/testpanel/testpanel').stop()"
                      disabled = "{!stTestRun.active}" />
                
                    <a:filler />
                </a:hbox>
            </a:bar>
            <!--a:tree 
              id            = "trTests" 
              canrename     = "false" 
              border        = "0" 
              simpledata    = "true"
              reselectable  = "true" 
              autoselect    = "false"
              flex          = "1" 
              empty-message = "No tests"
              model         = "mdlTests"
            >
                <a:each match="[repo|testfile|test|assert]">
                    <a:insert match="[folder]" get="{location.host and davProject.readdir([@path])}" />
                    <a:caption value="[@name]" />
                    <a:icon match2="[folder|project]" value="folder.png" />
                </a:each>
    
                <a:remove match="[file|folder]" set="{require('ext/filesystem/filesystem').remove([@path])}"/>
            </a:tree-->
            
            <a:model id="mdlTests">
                <data>
                    <repo name="Cloud9">
                    
                    </repo>
                </data>
            </a:model>
            
            <a:datagrid 
              id        = "dgTestProject"
              flex      = "1"
              options   = "size"
              model     = "mdlTests"
              each      = "[repo|file|test|assert|error]"
              style     = "border:4px solid #333"
              multiselect    = "true"
              startcollapsed = "true"
              contextmenu    = "mnuTestContext"
              empty-message  = "No tests yet">
                <a:column caption="Name" width="100%" tree="1" icon="{require('ext/testpanel/testpanel').getIcon(%[.])}"><?lm
                    if (localName() == "error")
                        <span style='color:red'>[@name]</span>
                    else
                        [@name]
                ?></a:column>
                <a:column caption="Status" width="110"><?lm
                    if ([@status] === '0')
                        <span style='color:red'>\[[@status-message]\]</span>
                    else if ([@status] == '1')
                        <span style='color:green'>\[PASS{[@status-message] and " [@status-message]"}\]</span>
                    else if ([@status] == '-1')
                        <span>\[{[@status-message].uCaseFirst()}\]</span>
                    else
                        "";
                ?></a:column>
                
                <a:insert match="[file]" get="{return require('ext/testpanel/testpanel').parseFile(xmlNode)}" />
                
                <a:expanded match="[test]" />
                <a:expanded match="[file[test]]" />
                <a:expanded match="{apf.getChildNumber(%[repo]) == 1}" />
            </a:datagrid>
            
            <!--
                @todo Edit could be test/assert
                      Remove could be test and assert
            -->
            <a:menu id="mnuTestContext">
                <a:item match="[test|file|repo[file]]">Run Test(s)</a:item>
                <a:item match="[file]">Edit</a:item>
                <a:divider />
                <a:item match="[file]">Remove</a:item>
            </a:menu>
        </a:vbox>
    </a:window>
</a:application>